% !TeX spellcheck = ru_RU
% !TEX root = artem-burashnikov_imageProcessingOnGPU.tex

\section{Подготовка тестового стенда}
\noindent В этом разделе указаны характеристики оборудования, на котором проводились исследования. Также были выдвинуты необходимые гипотезы, проверке которых посвещены проводимые эксперименты, и обозначены используемые метрики и инструменты для фиксирования измерений. Отдельно прокомментирован выбор набора тестируемых данных.



\subsection{Характеристики оборудования}
\noindent Аппаратная конфигурация обладает приведенными ниже характеристиками.
\subsubsection*{Операционная система}

\begin{verbatim}
Operating System: Ubuntu 22.04.2 LTS
\end{verbatim}

\subsubsection*{CPU}
\begin{verbatim}
Architecture:       x86_64
Model name:         AMD Ryzen 5 4500U with Radeon Graphics
Thread(s) per core: 1
Core(s) per socket: 6
\end{verbatim}

\subsubsection*{RAM}
\begin{verbatim}
Total (MB): 9351
\end{verbatim}

\subsubsection*{GPU}
\begin{verbatim}
Device: [AMD/ATI] Renoir (rev c3)
Memory: 256M
\end{verbatim}

\subsection{Исследовательские гипотезы}
\noindent Анализ поставленных задач позволил выдвинуть следующую гипотезу.

\subsubsection*{Гипотеза №1}
\label{t1}
\noindent Обработка изображений при помощи GPU должна демонстрировать ускорение даже для изображений сравнительно небольшого размера.



\subsection{Использованные метрики}
\noindent Для исследования~\hyperref[t1]{\textit{Гипотезы №1}} измерено ускорение алгоритма (\textit{англ. --- Speedup}) применения фильтра с использованием GPU относительно алгоритма применения этого же фильтра с использованием CPU:

\textit{Speedup} ($S$) вычисляется по формуле:
\begin{equation}
\label{eq:speedup}
	\text{S} = \frac{T_{old}}{T_{new}},
\end{equation}
где $T_{cpu}$ --- время применения фильтра на CPU, $T_{gpu}$ --- время применения фильтра на GPU.


\subsection{Инструменты для измерений}
\noindent Все замеры выполнены с использованием библиотеки для измерения производительности \texttt{BenchmarkDotNet v0.13.4}\footnote{\href{https://benchmarkdotnet.org/}{Библиотека .NET для замеров производительности. Дата посещения: \DTMdate{2023-05-23}}}, разрабатываемой и поддерживаемой для платформы \texttt{.NET}. Ниже приведены настрйки инструмента (для экспериментов использованы настройки по умолчанию).
\begin{itemize}[label=--]
    \item{\textbf{launchCount}} - общее количество запусков конкретного тестового метода. По умолчанию 1.
    \item{\textbf{warmupCount}} - количество итераций стадии разгорева. По умолчанию рассчитывается эвристикой.
    \item{\textbf{iterationTime}} - желаемое время исполнения итерации. По умолчанию 500 мс.
    \item{\textbf{iterationCount}} - количество итераций для тестового метода. По умолчанию рассчитывается эвристикой.
    \item{\textbf{invocationCount}} - количество вызовов метода за одну итерацию. По умолчанию рассчитывается эвристикой.
    \item{\textbf{unrollFactor}} - сколько раз тестовый метод будет вызван за одну итерации в рамках одного тестового цикла. По умолчанию 16.
    \item{\textbf{runOncePerIteration}} - флаг, отвечающий за запуск тестового метода ровно один раз за итерацию. По умолчанию \textit{False}.
\end{itemize}



\subsection{Набор данных}
\noindent Для фиксации исследуемых величин выбраны 5 изображений различного размера, имеющих квадратную матрицу пикселей. Такой выбор обусловлен тем, что для проверки гипотезы~\ref{t1} достаточно провести измерения на одинаковых изображениях, причем форма матрицы на производительность алгоритмов не оказывает влияния. Выбранные изображения представлены в таблице~\ref{images}. В качестве фильтра зафиксировано применение гаусовского размытия. Выбор данного фильтра обсловлен его базовыми свойствами, при которых можно провести качественные выводы.

\begin{table}[ht]
\begin{center}
\rowcolors{2}{black!2}{black!10}
\begin{tabular}{l|r|r|}
\hline
Изображение & Ширина, пикселей & Высота, пикселей \\
\hline
\hline
100x100.jpg                        &      100          &      100  \\
200x200.jpg                        &      200          &      200   \\
300x300.jpg                         &      300          &      300    \\
474x474.jpg                         &      400          &      400    \\
\hline
\end{tabular}
\end{center}
\caption{Набор изображений для проведения экспериментального исследования}
\label{images}
\end{table}



\subsection{Эксперимент}


\subsubsection*{Проверка инструмента измерения производительности}
\noindent  Измерения, полученные с помощью \texttt{BenchmarkDotNet}, проверены на нормальность при помощи библиотек языка \texttt{Python}: \texttt{SciPy v1.10.1}\footnote{\href{https://scipy.org/}{Библиотека языка Python для проведения научных и инженерных расчетов. Дата посещения: \DTMdate{2023-05-23}}}, \texttt{NumPy v1.24.3}\footnote{\href{https://numpy.org/}{Библиотека языка Python для математических вычислений. Дата посещения: \DTMdate{2023-05-23}}} и \texttt{Matplotlib v3.7.1}\footnote{\href{https://matplotlib.org/}{Библиотека языка Python для визуализации данных. Дата посещения: \DTMdate{2023-05-23}}}. Для этого отдельно выполнены 100 измерений производительности алгоритма на графе \texttt{mycielskian12} с параметром \texttt{parallelLevl} $=$ 3. Граф выбран как предположительно обладающий достаточным для эффективного применения асинхронных вычислений количеством вершин. Значение \texttt{parallelLevel} выбиралось как предположительно оптимальное. Результаты измерений зафиксированы в таблице~\ref{measured_time}.

\begin{table}[ht]
  \centering
  \resizebox{\textwidth}{!}{
  \begin{tabular}{*{10}{c}}
    \toprule
    Время 1 (мс) & Время 2 (мс) & Время 3 (мс) & Время 4 (мс) & Время 5 (мс) & Время 6 (мс) & Время 7 (мс) & Время 8 (мс) & Время 9 (мс) & Время 10 (мс) \\
    \midrule

    \bottomrule
  \end{tabular}
  }
\caption{Измерения, округленные до сотых значений, полученные во время работы параллельной версии алгоритма на графе \texttt{mycielskian12}, \texttt{parallelLevl} = $3$}\label{measured_time}
\end{table}

\noindent С помощью библиотеки \texttt{scipy} вызовом функций \texttt{stats.shapiro()} и \\
\texttt{stats.normaltest()} проверено соответствие полученных величин нормальному распределению. Значение \texttt{pvalue} соответствовало $0.15$ (Шапиро) и $0.13$ (Пирсон), что удовлетворяет критерию нормальности.
По данным в таблице~\ref{measured_time} построена гистограмма~\ref{histogram}. Вид гистограммы соответствует нормальному распределению.


\subsubsection*{Анализ результатов}
\noindent Ниже даны ответы на вопросы исследования.
Результаты измерения ускорения представлены на рис~\ref{results1}.

\begin{table}
  \centering
\includesvg[width=0.6\textwidth]{figures/fig}
\caption{Ускорение применения фильтра на GPU относительно CPU для изображения 100x100}
\label{results1}
\end{table}

Из графика видно, что наивное применение фильтра с использованием GPU становится быстрее для изображения $474$\times$474$. Это объясняется тем, что использование параллельных вычислений с помощью GPU даёт выигрыш в производительности пре идентичных операциях, которые необходимо применять на массив пикселей.
