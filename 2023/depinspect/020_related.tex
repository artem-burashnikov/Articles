% !TeX spellcheck = ru_RU
% !TEX root = burashnikov_depinspect.tex

\section{Обзор предметной области}
\label{sec:relatedworks}
Для проектирования требуемой системы с целью выявления желаемой функциональности необходимо ознакомиться с инструментами, предоставляющими анализ пакетов.
Кроме того, требуется сделать выбор первоначальных дистрибутивов и проанализировать форматы, в которых представлены метаданные.
В следующих разделах освещены эти вопросы.

\subsection{Существующие аналоги}
В конкретном дистрибутиве используется своё программное обеспечение, позволяющее провести искомый анализ.
Далее представлены некоторые из них.

\subsubsection{\texttt{Apt}}
\texttt{Apt}\footnote{\href{https://manpages.debian.org/stretch/apt/apt.8.en.html\#SCRIPT\_USAGE\_AND\_DIFFERENCES\_FROM\_OTHER\_APT\_TOOLS/}{Документация apt. Дата обращения: \DTMdate{2023-12-13}}} --- это пакетный менеджер, по умолчанию поставляемый вместе с дистрибутивом {\debian} и производными системами, основанными на {\debian}, но разрабатываемыми независимо и имеющими собственную целевую аудиторию и цели\footnote{\href{https://www.debian.org/derivatives/}{Понятие прозводной системы на сайте {\debian}. Дата обращения: \DTMdate{2023-12-13}}}.
Согласно документации, \texttt{apt} является высокоуровневой оболочкой для других инструментов, поэтому для просмотра предоставляемой функциональности нужно обратиться к \texttt{apt-cache}\footnote{\href{https://manpages.debian.org/stretch/apt/apt-cache.8.en.html}{Документация \texttt{apt-cache}. Дата обращения: \DTMdate{2023-12-13}}}, команды которого доступны и для \texttt{apt}.
Следующие возможности утилиты согласуются с целью работы:
\begin{enumerate}
	\item \texttt{depends} отображает список каждой зависимости, которую имеет пакет, а также все возможные другие пакеты, которые могут удовлетворить эту зависимость;
	\item \texttt{rdepends} отображает список пакетов, для которых данный является зависимостью;
	\item \texttt{pkgnames} выводит название каждого пакета, о котором знает \texttt{apt}.
\end{enumerate}

Одним из существенных минусов \texttt{apt} является то, что программу не имеет смысла использовать на других дистрибутивах, потому что менеджер плотно интегрирован с системами, под которые создавался.
Кроме того, по умолчанию нет возможности сравнить пакеты в рамках даже одного дистрибутива.

\subsubsection{\texttt{Pactree}}
\texttt{Pactree}\footnote{\href{https://man.archlinux.org/man/extra/pacman-contrib/pactree.8.en}{Документация pactree. Дата обращения: \DTMdate{2023-12-13}}} --- утилита для дистрибутива \textsc{Arch Linux}, позволяющая выводить на экран деревовидную структуру зависимостей для пакетов.
Из функциональности отмечаются те же пункты, что и для \texttt{apt}. Дополнительно имеется возможность вывода результата запроса в формате \texttt{Graphviz}\footnote{\href{https://graphviz.org/}{Приложение Graphviz для визуализации графов. Дата обращения: \DTMdate{2023-12-13}}} для последующей визуализации полученного графа.

Минус \texttt{pactree} заключается в том, что \textsc{Arch~Linux} не поддерживает архитектуру \textsc{RISC-V}, которая, соглас\-но Бенжамину~В.~Мезгеру (Benjamin~W.~Mezger) и др., набирает популярность и активно развива\-ется~\cite{RISCVSurvey}.

\subsubsection{\texttt{Debtree}}
\texttt{Debtree}\footnote{\href{https://manpages.ubuntu.com/manpages/xenial/man1/debtree.1.html}{Документация debtree на ресурсе {\ubuntu}. Дата обращения: \DTMdate{2023-12-13}}} --- инструмент для {\debian} и производных систем, позиционирующий себя как ``граф зависимостей на стероидах''. Функциональность сосредоточена на выводе графа в той или иной форме.
Выводит результет на языке \texttt{dot}, читаемом утилитой \texttt{Graphviz}. Возможности аналогичны уже обозначенным приложениям, однако обладает дополнительными опциями для построения графов (например, цвет, глубина и т.д.).
Отдельно стоит отметить возможность при вызове команды добавить флаг \textbf{{-}{-}arch}, указав архитектуру, зависимость пакета на которой требуется показать.

К сожалению, \texttt{Debtree} можно использовать только на производных {\debian}. Инструмент не позволяет сравнивать в каком бы то виде метаданные пакетов между собой.
Кроме того, несмотря на то, что можно указать архитектуру, без дополнительных системных настроек будет использована архитектура системы, на которой запущено приложение.

\subsubsection{\texttt{Repology}}
\texttt{Repology}\footnote{\href{https://repology.org/docs/about}{Информация о ресурсе Repology. Дата обращения: \DTMdate{2023-12-13}}} в отличие от уже рассмотренных приложений напрямую не позиционируется как система анализа пакетов.
Проект является аггрегатором репозиториев и смежных ресурсов, предоставляющих установочные архивы. \texttt{Repology} имеет обширный список возможностей для анализа версий библиотек, наличия или отсутствия их в репозиториях.
Согласно описанию, сервис отслеживает и позволяет сравнивать версии пакетов между более чем 120 репозиториями.
Хотя \texttt{Repology} и не предоставляет никакой логики для сравннения зависимостей, особое внимание уделено некоторым аспектам технической реализации проекта в целом, потому что они интересны для проектируемой в рамках семестровой практики системы.

Во-первых, серис представляет собой веб-приложение, разделенное на несколько независимых компонент: \textbf{webapp}\footnote{\href{https://github.com/repology/repology-webapp}{Репозиторий компоненты webapp сервиса Repology. Дата обращения: \DTMdate{2023-12-13}}}, \textbf{updater}\footnote{\href{https://github.com/repology/repology-webapp}{Репозиторий компоненты updater сервиса Repology. Дата обращения: \DTMdate{2023-12-13}}} и \textbf{ruleset}\footnote{\href{https://github.com/repology/repology-webapp}{Репозиторий компоненты ruleset сервиса Repology. Дата обращения: \DTMdate{2023-12-13}}}.
В-вторых, сами метаданные скачиваются из архивов соответствующих дистрибутивам репозиториев (те же репозитории использует, например \texttt{apt}), затем сервис производит парсинг загруженных метаданных и сохранение их в базах данных \textsc{SQLite}.
Указанные особенности реализации оказались интересны для проектируемой системы, так как позволили внедрить модульный дизайн и обеспечить переиспользование полученной из репозиториев информации об архивах.

\subsection{Результаты анализа аналогов}
В таблице~\ref{tbl:tool-comparison} представлены рассмотренные инструменты и основная функциональность каждого из них.

\begin{table}[ht]
	\centering
	\begin{tabular}{|c|c|c|c|c|}
		\hline
		& Apt & Pactree & Debtree & Repology \\
		\hline
		Прямые зависимости & \checkmark & \checkmark & \checkmark & \checkmark \\
		\hline
		Обратные зависимости & \checkmark & \checkmark & \checkmark & \checkmark \\
		\hline
		Сравнение метаданных & \ding{55} & \ding{55} & \ding{55} & \ding{55} \\
		\hline
		Построение графа & \ding{55} & \checkmark & \checkmark & \ding{55} \\
		\hline
		Кросс-платформенность & \ding{55} & \ding{55} & \ding{55} & \checkmark \\
		\hline
	\end{tabular}
	\caption{Сравнение инструментов}
	\label{tbl:tool-comparison}
\end{table}

Таким образом, вывод для пакета его прямых и обратных метаданных --- основная функциональность, присущая всем утилитам такого рода.
Далее, не все рассмотренные приложения могут рисовать полный граф зависимостей и никакая из утилит не может напрямую проводить сравнение метаданных пакетов между различными архитектурами ни в рамках одного дистрибутива, ни между пакетами в рамках различных дистрибутивов.
Так, в основу созданного инструмента заложены следующие особенности:
\begin{enumerate}
	\item сравнение по прямым зависимостям пакетов между различными архитектурами в рамках одного дистрибутива;
	\item вывод имен пакетов и архитектур, для которых можно произвести сравнение;
	\item архитектура приложения должна быть гибкой и позволять расширять фукциональность, используя не только зависимости, но и другие потенциально значимые метаданные;
	\item аггрегация пакетов из различных дистрибутивов;
	\item кросс-платформенность инструмента.
\end{enumerate}

\subsection{Формат метаданных}
Прежде всего необходимо понимать возмножные отношения, используемые между пакетами\footnote{\href{https://www.debian.org/doc/debian-policy/ch-relationships.html}{Руководство Debian. Дата посещения \DTMdate{2023-12-14}}}.
Ниже на примере спецификации формата метаданных в дистрибутиве {\debian} приведен список таких отношений с пояснениями:
\begin{enumerate}
	\item \textit{Depends}.\newline
	      Пакет \textbf{A} не будет настроен, пока все пакеты, перечисленные в этом поле не будут корректно настроены. Пакет может находиться в системе в ``не настроенном'' состоянии.
	\item \textit{Recommends}.\newline
	      Для пакета \textbf{A} в этом поле перечислены пакеты, которые обычно устанавливаются вместе c \textbf{A}.
	\item \textit{Suggests}.\newline
	      Перечисленные в этом поле пакеты связаны с пакетом \textbf{A} и, возможно, могут улучшить его полезность, но установка только \textbf{A} без них разумна и ничем не ограничена.
	\item \textit{Enhances}.\newline
	      Работает как \textit{Suggests}, но в обратную сторону: в этом поле указаны пакеты, для которых пакет \textbf{A} попадает в \textit{Suggests}, потенциально улучшая их полезные свойства.
	\item \textit{Pre---Depends}.\newline
	      Означает почти то же, что и \textit{Depends}, но дополнительно требует завершения установки указанных в поле пакетов до установки пакета \textbf{A}.
	\item \textit{Conflicts}.\newline
	      Пакеты, указанные в этом поле, не могут существовать в системе одновременно с пакетом \textbf{A}.
	\item \textit{Provides}.\newline
	      В этом поле указаны виртуальные пакеты\footnote{\href{https://www.debian.org/doc/debian-policy/ch-binary.html\#s-virtual-pkg}{Виртуальные пакеты в руководстве Debian. Дата посещения \DTMdate{2023-12-14}}}, которые предоставляются пакетом \textbf{A}.
	\item \textit{Replaces}.\newline
	      Если пакет \textbf{B} указан в этом поле для пакета \textbf{A}, то \textbf{B} должен быть удалён, прежде чем будет установлен \textbf{A}.
\end{enumerate}

Понимание того, какие взаимоотноешния встречаются между пакетами позволяет однозначно истолковывать те ситуации, когда названия полей в других дистрибутивах отличаются.
Так, для пакетов формата \texttt{rpm} поле \textit{Depends} встречается в виде \textit{Requires}, но по своей сути означает одно и то же.

Помимо спецификации отношений важным оказался формат файлов метаданных, выкладываемых в репозиториях дистрибутивов.
Далее приведене некоторые из них:
\begin{itemize}
	\item текстовые файлы, в которых каждая строчка является некоторым полем (встречаются, например, в {\debian} и {\ubuntu});
	\item файлы в формате \texttt{XML}, где метаданные указаные с помощью языка разметки;
	\item файл базы данных \textsc{SQLite}, в которой присутствуют таблицы с обозначенными отношениями.
\end{itemize}

Для разработанного приложения важным оказался именно формат \textsc{SQLite}, так как внедрение баз данных помогло решить проблему переиспользования полученных метаданных и существенно увеличило гибкость утилиты, позволив извлекать информацию с разной степенью сложности с помощью реализации абстракции над языком запросов \textsc{SQL}.

\subsection{Выбор дистрибутивов}
Выбраны две операционые системы, чьи особенности на первичном этапе учтены при разработке.
Обе ОС входят в десятку самых популярных, согласно данным портала \textsc{DistroWatch}\footnote{\href{https://distrowatch.com/}{Главная страница портала DistroWatch с рейтингами дистрибутивов. Дата посещения \DTMdate{2023-12-14}}}.

\paragraph{\ubuntu}
Так как разработка проекта велась на системе, на которой установлен {\ubuntu}, а синтаксис метаданных этого дистрибутива представляет собой упрощенный вариант обобщенного синтаксиса {\debian}, то этот дистрибутив был выбран в качестве первого.
Внедрение {\ubuntu} помогло создать прототип требуемого приложения и консольный интерфейс для конечного пользователя.

\paragraph{\fedora}
Вторым дистрибутивом выбрана {\fedora}, потому что метаданные для этой системы предоставляются в виде базы данных \textsc{SQLite}, что существенно упростило процесс внедрения.
Кроме того, синтаксис для пакетов и их метаданных, используемый в {\fedora}, по историческим причинам кардинально отличается от {\debian}. Таким образом, выбор данного дистрибутива позволил создать приложение, способное обращаться с несовместимыми форматами метаданных различных дистрибутивов.

Проведенный обзор инструментов, формата метаданных и выбор дистрибутивов позволили спроектировать требуемый инструмент.
В следующих разделах продемонстрирована используемая архитектура и затронуты детали реализации.
